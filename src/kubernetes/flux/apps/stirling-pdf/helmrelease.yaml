---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: stirling-pdf
  namespace: stirling-pdf
spec:
  interval: 30m
  chart:
    spec:
      chart: stirling-pdf-chart
      version: "2.2.0"
      sourceRef:
        kind: HelmRepository
        name: stirling-pdf
        namespace: flux-system
      interval: 12h

  values:
    # Override the full name to simplify service references
    fullnameOverride: stirling-pdf

    # Replica count
    replicaCount: 1

    # Image configuration
    image:
      registry: docker.stirlingpdf.com
      repository: stirlingtools/stirling-pdf
      pullPolicy: IfNotPresent

    # Environment variables for customization
    envs:
      - name: TZ
        value: "America/New_York"
      - name: UI_APP_NAME
        value: "Stirling PDF"
      - name: UI_HOME_DESCRIPTION
        value: "Your locally hosted one-stop-shop for all your PDF needs."
      - name: UI_APP_NAVBAR_NAME
        value: "Stirling PDF"

    # Service configuration
    service:
      type: ClusterIP
      externalPort: 8080

    # Ingress (disabled - using Gateway API HTTPRoute)
    ingress:
      enabled: false

    # Persistence for temporary files
    persistence:
      enabled: true
      accessMode: ReadWriteOnce
      size: 5Gi
      storageClass: longhorn
      path: /tmp

    # Resource management
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 2000m
        memory: 2Gi

    # Health probes
    probes:
      liveness:
        enabled: true
        initialDelaySeconds: 30
        periodSeconds: 10
        timeoutSeconds: 5
        failureThreshold: 5
      readiness:
        enabled: true
        initialDelaySeconds: 30
        periodSeconds: 10
        timeoutSeconds: 5
        failureThreshold: 5

    # Security context
    securityContext:
      enabled: true
      fsGroup: 1000
